name: Auto Label by Branch
on:
  pull_request:
    types: [opened, edited]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    steps:
      - name: Auto Label PR
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const branchName = context.payload.pull_request.head.ref;
            const prTitle = context.payload.pull_request.title.toLowerCase();
            const labels = [];
            
            // Lấy danh sách files thay đổi
            const { data: files } = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number
            });
            
            console.log('Changed files:', files.map(f => f.filename));
            
            // Kiểm tra folder nào có thay đổi
            const hasAdminChanges = files.some(file => file.filename.startsWith('mmenu-admin/'));
            const hasCdpChanges = files.some(file => file.filename.startsWith('mmenu-cdp/'));
            const hasApiChanges = files.some(file => file.filename.startsWith('mmenu-api/'));
            
            console.log('Folder changes detected:', {
              admin: hasAdminChanges,
              cdp: hasCdpChanges, 
              api: hasApiChanges
            });
            
            // ADMIN - mmenu-admin folder
            if (hasAdminChanges) {
              labels.push('ADMIN');
            }
            
            // CDP - mmenu-cdp folder  
            if (hasCdpChanges) { 
              labels.push('CDP');
            }
            
            // API - mmenu-api folder
            if (hasApiChanges) {
              labels.push('API');
            }
            

            console.log(`Branch: ${branchName}`);
            console.log(`Adding labels: ${labels.join(', ')}`);
